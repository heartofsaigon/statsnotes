<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nam-Anh Tran">
<meta name="dcterms.date" content="2024-06-19">

<title>Basic Bayesian Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="01A_basic-bayesian-model_files/libs/clipboard/clipboard.min.js"></script>
<script src="01A_basic-bayesian-model_files/libs/quarto-html/quarto.js"></script>
<script src="01A_basic-bayesian-model_files/libs/quarto-html/popper.min.js"></script>
<script src="01A_basic-bayesian-model_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="01A_basic-bayesian-model_files/libs/quarto-html/anchor.min.js"></script>
<link href="01A_basic-bayesian-model_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="01A_basic-bayesian-model_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="01A_basic-bayesian-model_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="01A_basic-bayesian-model_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="01A_basic-bayesian-model_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="01A_basic-bayesian-model.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Basic Bayesian Models</h1>
<p class="subtitle lead">(MATH533:Assigment 03)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nam-Anh Tran </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Regression is a common task in many fields, where the most statistical training is mainly provided based on the frequentist framework. Conditional on fixed hypotheses, p-value and confidence intervals are the two most frequently used final results, which are reported as the traditional statistical analysis. Although used in numerous contexts, the frequentist framework has still been criticized as the results are obtained based on the assumed null hypothesis which, in fact, is unknown before undertaking analysis <span class="citation" data-cites="baldwin2017introduction">[<a href="#ref-baldwin2017introduction" role="doc-biblioref">1</a>]</span>.</p>
<p>The Bayesian method is a useful tool as the uncertainty of the hypotheses is considered in this framework. Hence, our belief in the hypotheses is reflected via the data observation. Also, This paradigm aids in moving beyond hunting for statistical significance and focusing on other aspects of statistical models such as prediction, model fit, data visualization, and uncertainty <span class="citation" data-cites="baldwin2017introduction">[<a href="#ref-baldwin2017introduction" role="doc-biblioref">1</a>]</span>. Furthermore, complex models can be developed and evaluated with ease based on the Bayesian framework.</p>
</section>
<section id="bayesian-method-and-its-potential" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Bayesian method and its potential</h1>
<p>We start the Bayesian analysis by specifying the prior distribution (or the prior) that reflects a priori information about parameters of interest before we observe the data. The prior distribution is then updated using the data, through the likelihood function, to produce the posterior distribution. This is the reason this framework is deemed the combination of what is learned about the parameters from the data. The prior distribution, therefore, is chosen with little information of the parameters by assigning high uncertainty to the parameters. The specification of prior distribution bases on the expertise of researchers in the area or the relevant studies. The information elicited from studies or researches’ expertise is also call the evidence which is then translated to probabilistic function (i.e.&nbsp;the prior). The function’s domain is the set of all potential values of the parameters. We then adjust the hyper-parameters of the prior such that its mode, mean, and variance align with the evidence. For example, if we know the amount of sugar in blood of diabetes patients is around 126 mg/dL, and we assume it follows Gamma distribution. We then specify the location and rate parameters such that the mode aligns with 126, and the variance reflects the level of uncertainty about 126 (may be measured based on the Fisher-information).</p>
<p>The idea of gathering evidence of the parameters before observing data receives criticism since it proceeds subjectively. However, Baldwin et. al. <span class="citation" data-cites="baldwin2017introduction">[<a href="#ref-baldwin2017introduction" role="doc-biblioref">1</a>]</span> claimed that the subjectivity is unavoidable and embodied in both the frequentist and Bayesian paradigms. For example, choosing a specific statistical approach among potential methods is also an indication of the subjectivity. Further, collecting the evidence of the hypothesis based on experts in the area before accessing the data may increase the usefulness. This is because the experts often know the topic very well and are able to direct the choice of priors knowingly. Thus, selecting the priors requires in-depth discussion between experts in the area and statisticians who have expertise in the prior elicitation technique and the decision theory.</p>
</section>
<section id="controlling-the-uncertainty-of-elicited-priors" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Controlling the uncertainty of elicited Priors</h1>
<p>Inherited from the Bayes formula, the posterior distribution is expressed as <span class="math inline">\(f({\boldsymbol{\theta}}|{\boldsymbol{y}}) \propto f({\boldsymbol{y}}|{\boldsymbol{\theta}})f({\boldsymbol{\theta}})\)</span>, where <span class="math inline">\(f({\boldsymbol{y}}|{{\boldsymbol{\theta}}})\)</span> and <span class="math inline">\(f({\boldsymbol{\theta}})\)</span> are the likelihood function and the prior. We then adapt it to the linear model <span class="math inline">\({\boldsymbol{y}} = {\boldsymbol{X\theta}}+ {\boldsymbol{\varepsilon}}\)</span>, where <span class="math inline">\({\boldsymbol{\varepsilon}}\stackrel{iid}{\sim} N({\boldsymbol{0}}, \sigma^2{\boldsymbol{I}})\)</span>, and the likelihood function is now the normal density function where the mean is the linear term <span class="math inline">\({\boldsymbol{X\theta}}\)</span> <span class="citation" data-cites="klauenberg2015tutorial">[<a href="#ref-klauenberg2015tutorial" role="doc-biblioref">2</a>]</span>.</p>
<p><span id="eq-eq01"><span class="math display">\[
f({\boldsymbol{y}}|{\boldsymbol{\theta}}) = \frac{1}{\sqrt{2\pi}\sigma}\times\exp\Big\{-\frac{1}{2\sigma^2}({\boldsymbol{y}} - {\boldsymbol{X\theta}})'({\boldsymbol{y}} - {\boldsymbol{X\theta}})\Big\}.
\tag{1}\]</span></span></p>
<p>The class of potential prior distributions is broad, so selecting a good prior distribution depends on the different purposes. For example, the conjugacy is a subclass of the prior distributions, where the prior and posterior distribution have the same form <span class="citation" data-cites="rencher2008linear">[<a href="#ref-rencher2008linear" role="doc-biblioref">3</a>]</span>. If the conjugate prior is used, the posterior distribution has the closed-form and, thus, we can draw the inference about the parameters with ease. In contrast, if the posterior distribution does not have a closed-form, the Markov chain Monte Carlo (MCMC) or its variants will be employed, and this may increase the computational complexity.</p>
<p>For the illustrative purpose, let <span class="math inline">\({\boldsymbol{\theta}} = \mu\)</span> and <span class="math inline">\(\sigma = 60\)</span> and, thus, <span class="math inline">\({\boldsymbol{X}} = \mu{\boldsymbol{1}}_n\)</span> and <span class="math inline">\({\boldsymbol{y}}\sim N(\mu{\boldsymbol{1}}_n,60^2{\boldsymbol{1}})\)</span>. The normal distribution is now chosen as the prior of <span class="math inline">\(\mu\)</span>., i.e.&nbsp;<span class="math inline">\(\mu \sim N(\mu_0,\sigma^2_0)\)</span>. We can then show that the posterior distribution of <span class="math inline">\(\mu\)</span> is also a normal distribution where the mean and the variance are</p>
<p><span id="eq-eq02"><span class="math display">\[
\mu_{\text{post}} = \bigg(\frac{1}{\sigma^2_0}+\frac{n}{\sigma^2}\bigg)^{-1}\bigg(\frac{\mu_0}{\sigma^2_0} + \frac{\sum_{i=1}^ny_i}{\sigma^2} \bigg), \quad
\sigma_{\text{post}} = \bigg(\frac{1}{\sigma^2_0}+\frac{n}{\sigma^2}\bigg)^{-1/2},
\tag{2}\]</span></span> respectively. Thus, the data <span class="math inline">\(y_i\)</span> and hyperparameters <span class="math inline">\((\mu_0,\sigma_0)\)</span> have to be specified before calculating the parameters of the posterior distribution.</p>
<p>Let <span class="math inline">\(y_i\)</span> (<span class="math inline">\(i= 1,2,\dots,20\)</span>) is the anxiety score at the position time point of the child <span class="math inline">\(i\)</span> who received intranasal dexmedetomidine as an anxiolytic for the laceration repair in a pediatric emergency department. We now generate a “fake” data as follows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">9999</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">library</span>(<span class="st">"pacman"</span>, <span class="at">logical.return =</span> T)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(estmeansd, tidyverse, knitr, brms, HDInterval, LaplacesDemon, brms)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">library</span>(<span class="st">"rjags"</span>, <span class="at">logical.return =</span> T)) <span class="fu">install.packages</span>(<span class="st">"rjags"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">###############################</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">100</span>, <span class="dv">10</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the prior, we determine the hyperparameter <span class="math inline">\(\mu_0\)</span> and <span class="math inline">\(\sigma^2_0\)</span> based on the evidence from a relevant study, where intranasal dexmedetomidine (IND) versus intranasal midazolam (INM) were assessed in a double-blind randomized controlled trial <span class="citation" data-cites="neville2016double">[<a href="#ref-neville2016double" role="doc-biblioref">4</a>]</span>. <a href="#fig-fig01">Figure&nbsp;1</a> shows the anxiety scores reported in the study, and the value of interest is highlighted.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-fig01" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<figcaption class="figure-caption">Figure&nbsp;1: Anxiety Scores at Four Time Points in Each Treatment Arm.</figcaption>
<p><img src="01A_Table02.png" class="img-fluid figure-img" width="1033"></p>
</figure>
</div>
</div>
</div>
<p>We now specify the hyperparameters <span class="math inline">\({\boldsymbol{\theta}}_0 =(\mu_0, \sigma_0)\)</span> using the median and IQR of the anxiety score. This can be carried out with ease in R using the package <code>estmeansd</code> (for a more detailed method, refer to Wan et. al. <span class="citation" data-cites="cai2021estimating">[<a href="#ref-cai2021estimating" role="doc-biblioref">5</a>]</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>thet_0 <span class="ot">=</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  estmeansd<span class="sc">::</span><span class="fu">mln.mean.sd</span>(<span class="at">q1.val =</span> <span class="dv">23</span>, <span class="at">med.val =</span> <span class="fl">23.3</span>, <span class="at">q3.val =</span> <span class="dv">35</span>, <span class="at">n =</span> <span class="dv">20</span>)<span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  {\(i) i[<span class="fu">c</span>(<span class="st">"est.mean"</span>, <span class="st">"est.sd"</span>)]}()<span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()<span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>mu_0 <span class="ot">=</span> thet_0[[<span class="dv">1</span>]]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>sig_0 <span class="ot">=</span> thet_0[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Thus, the hyperparameters are <span class="math inline">\(\mu_0 =\)</span> 27.48 and <span class="math inline">\(\sigma_0 =\)</span> 8.32, and the corresponding parameters of the posterior distribution are calculated using <a href="#eq-eq02">Equation&nbsp;2</a>; then, the corresponding density curve of the likelihood, prior, and posterior distributions are shown in <a href="#fig-fig02">Figure&nbsp;2</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>GetPost1 <span class="ot">=</span> <span class="cf">function</span>(mu_0, sig_0, sig, y){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  sigma2_0 <span class="ot">=</span> sig_0<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  sigma2 <span class="ot">=</span> sig<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> (mu_0<span class="sc">/</span>sigma2_0 <span class="sc">+</span><span class="fu">sum</span>(y)<span class="sc">/</span>sigma2)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span>sigma2_0 <span class="sc">+</span> <span class="fu">length</span>(y)<span class="sc">/</span>sigma2)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  sig <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>sigma2_0 <span class="sc">+</span> <span class="fu">length</span>(y)<span class="sc">/</span>sigma2)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(mu, sig)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>thet_pos <span class="ot">=</span> <span class="fu">GetPost1</span>(mu_0, sig_0, <span class="dv">60</span>, y)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>mu_pos <span class="ot">=</span> thet_pos[<span class="dv">1</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>sig_pos <span class="ot">=</span> thet_pos[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, mu_0, sig_0), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">150</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.07</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">"anxiety score"</span>, <span class="at">ylab =</span> <span class="st">"density"</span>, <span class="at">col =</span> <span class="st">"grey50"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(y), <span class="at">col =</span> <span class="st">"lightblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, mu_pos, sig_pos), <span class="at">add =</span> T, <span class="at">col =</span> <span class="st">"deeppink"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey50"</span>, <span class="st">"lightblue"</span>, <span class="st">"deeppink"</span>), </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Prior"</span>, <span class="st">"Data"</span>, <span class="st">"Posterior"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig02" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<figcaption class="figure-caption">Figure&nbsp;2: The density curve of the likelihood, prior and posterior distribution.</figcaption>
<p><img src="01A_basic-bayesian-model_files/figure-html/fig-fig02-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The posterior distribution (pink) is the combination of the prior (grey) and the likelihood or data (blue). Thus, the posterior density curve can move between the prior and likelihood. The distance between the posterior and the likelihood depends on the sample size and the uncertainty we assign to the prior by specifying the variance (i.e.&nbsp;<span class="math inline">\(\sigma_0\)</span>). To see this, we calculate four posterior distributions corresponding to <span class="math inline">\(\sigma_0 = 5, 10, 20\)</span> and <span class="math inline">\(2000\)</span>, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>thet_pos <span class="ot">=</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">2000</span>), \(i)  <span class="fu">GetPost1</span>(mu_0, i, <span class="dv">60</span>, y))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(y),<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">150</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.09</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">"anxiety score"</span>, <span class="at">ylab =</span> <span class="st">"density"</span>, <span class="at">col =</span> <span class="st">"lightblue"</span>, <span class="at">main =</span> <span class="st">""</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>(<span class="fu">dnorm</span>(x, thet_pos[[i]][<span class="dv">1</span>], thet_pos[[i]][<span class="dv">2</span>]), </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> T, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey80"</span>, <span class="st">"violet"</span>, <span class="st">"pink"</span>, <span class="st">"deeppink"</span>)[i], <span class="at">lwd =</span><span class="fl">0.5</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density(y),xlim = c(0,150), ylim = c(0,0.09),</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#       xlab = "anxiety score", ylab = "density", col = "lightblue", main = "", </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#      lwd = 2)</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">106</span>,<span class="fl">0.093</span>, <span class="at">legend =</span> <span class="st">"Likelihood"</span>, <span class="at">col =</span> <span class="st">"lightblue"</span>, <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">100</span>, <span class="fl">0.084</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey80"</span>, <span class="st">"violet"</span>, <span class="st">"pink"</span>, <span class="st">"deeppink"</span>), </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>( </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(sigma[<span class="dv">0</span>] <span class="sc">~</span> <span class="st">"="</span> <span class="sc">~</span> <span class="dv">5</span>), </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(sigma[<span class="dv">0</span>] <span class="sc">~</span> <span class="st">"="</span> <span class="sc">~</span> <span class="dv">10</span>),</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(sigma[<span class="dv">0</span>] <span class="sc">~</span> <span class="st">"="</span> <span class="sc">~</span> <span class="dv">20</span>),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(sigma[<span class="dv">0</span>] <span class="sc">~</span> <span class="st">"="</span> <span class="sc">~</span> <span class="dv">2000</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                   ),<span class="at">lty =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">lwd =</span><span class="dv">2</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">title =</span> <span class="fu">as.expression</span>(<span class="fu">bquote</span>(<span class="fu">bold</span>(<span class="st">"Posterior Distributions"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig03" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<figcaption class="figure-caption">Figure&nbsp;3: The density curve of four posterior distributions corresponding to <span class="math inline">\(\sigma_0\)</span> = 5, 10, 20, and 2000, respectively.</figcaption>
<p><img src="01A_basic-bayesian-model_files/figure-html/fig-fig03-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-fig03">Figure&nbsp;3</a> depicts the density curve of four posterior distributions. The mean of posterior distribution is closer to that of the data as the prior standard deviation is higher (i.e.&nbsp;more uncertainty about the prior). Roughly speaking, when you assign a very uncertain belief to the parameters, the total information we use to estimate the parameters is from the data.</p>
</section>
<section id="bayesian-models" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Bayesian models</h1>
<p>We consider the Bayesian models that include covariates. the models now become more complicated and no longer is the closed form of posterior distribution guaranteed. As mentioned, MCMC can be used to simulate samples of the posterior distribution, and the inference of the model parameters is drawn based on those samples. The MCMC will be briefly summarized before we consider the model.</p>
<section id="mcmc" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="mcmc"><span class="header-section-number">4.1</span> MCMC</h2>
<p>MCMC algorithms allow generating data points from a known distribution without a closed-form. This evaluation requires the form of the posterior density up to a constant, i.e., the likelihood for the data as well as the prior for each parameter. MCMC requires thousands and sometime tens of thousands of evaluations of the proposal values. The algorithms require that we decide either yes or no for each proposal. If yes, we keep the proposal value as a valid draw from the posterior. If no, the proposal value is discarded and the most recent accepted values replaces the proposal.</p>
</section>
<section id="model-1-a-one-covariate-linear-model" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="model-1-a-one-covariate-linear-model"><span class="header-section-number">4.2</span> Model 1: a one-covariate linear model</h2>
<p>The row <span class="math inline">\(i\)</span> of matrix <span class="math inline">\({\boldsymbol{X}}\)</span> in <a href="#eq-eq01">Equation&nbsp;1</a> is now <span class="math inline">\((1,x_i)\)</span>, representing the intercept and slope of the model. The response and covariate of the model are:</p>
<ol type="1">
<li><p>Outcome: the error-related negativity (ERN) representing potential neural endophenotype identifying anxiety-related traits and pathology; and</p></li>
<li><p>Covariate: the State-Trait Anxiety Inventory (ANX).</p></li>
</ol>
<p><a href="#tbl-tblb">Table&nbsp;1</a> shows the 5 first and last rows of the data that we use to fit the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"01A_data/ern_anxiety_data.csv"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(dat, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>((<span class="fu">nrow</span>(dat)<span class="sc">-</span><span class="dv">4</span>)<span class="sc">:</span><span class="fu">nrow</span>(dat))))<span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-tblb" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;1: 5 first and last rows of the data.</caption>
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">ern_mean</th>
<th style="text-align: right;">anxiety</th>
<th style="text-align: right;">sex</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.1139182</td>
<td style="text-align: right;">-0.2370106</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-3.8596835</td>
<td style="text-align: right;">0.4556956</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">-1.7995283</td>
<td style="text-align: right;">-0.9297168</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">-0.1023122</td>
<td style="text-align: right;">0.4556956</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-0.1648984</td>
<td style="text-align: right;">1.7421500</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">77</td>
<td style="text-align: right;">-3.9056299</td>
<td style="text-align: right;">-0.2370106</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">78</td>
<td style="text-align: right;">-2.8752533</td>
<td style="text-align: right;">-0.8307587</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">79</td>
<td style="text-align: right;">-0.1638889</td>
<td style="text-align: right;">0.0598635</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">80</td>
<td style="text-align: right;">-1.1593564</td>
<td style="text-align: right;">-0.0390945</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">81</td>
<td style="text-align: right;">-1.4591765</td>
<td style="text-align: right;">-0.2370106</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Given the proposed relationship between ERN amplitude and the trait anxiety, some researchers are suggesting the ERN be used in diagnostic and treatment studies as a potential means for identifying the presence/absence of some forms of trait-like psychopathology and determining if there is neural change following treatment <span class="citation" data-cites="baldwin2017introduction">[<a href="#ref-baldwin2017introduction" role="doc-biblioref">1</a>]</span>.</p>
<p>The model is then <span class="math display">\[
ERN_i = \beta_0 + \beta_1ANX_i + \varepsilon_i, \quad \varepsilon_i \stackrel{iid}{\sim} N(0,\sigma^2).
\]</span></p>
<p>To fit the model using the Bayesian framework, we specify the priors as follows: <span class="math display">\[
\beta_0, \beta_1 \sim N(0,3), \quad \sigma \sim \text{half-Cauchy}(0, 2.5).
\]</span> The credible interval of <span class="math inline">\(\beta_i\)</span> (<span class="math inline">\(i=1,2\)</span>) is (-5.67, 5.83), and <span class="math inline">\(\sigma\)</span> (0, 329.64). These intervals indicate our belief in the parameters before observing the data. the parameters of interest <span class="math inline">\(\beta_i\)</span> and the redundant parameter <span class="math inline">\(\sigma\)</span> fall somewhere between <span class="math inline">\(-5.5\)</span> and <span class="math inline">\(6\)</span> and <span class="math inline">\(0\)</span> and <span class="math inline">\(330\)</span> with the probability of <span class="math inline">\(95\)</span>%, respectively. Note that the length of the interval of <span class="math inline">\(\sigma\)</span> is quite long and its upper bound is <span class="math inline">\(\approx 330\)</span>; this implies a very low certainty of <span class="math inline">\(\sigma\)</span>.</p>
<p>We now fit the model using both Bayesian and frequentist frameworks. For Bayesian, we use the <code>rjags</code>. <a href="#tbl-tbl01">Table&nbsp;2</a> depicts the estimates of model parameters, i.e.&nbsp;<span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. <a href="#fig-fig04">Figure&nbsp;4</a> shows the density curve of posterior of both model parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to fit the model using rjags, we need to download and install the jags </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># software on the site before  do `install.packages("rjags")` in R. </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">394589</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>model_dat <span class="ot">=</span> <span class="fu">list</span>(<span class="at">ern =</span> dat<span class="sc">$</span>ern_mean, <span class="at">anxiety =</span> dat<span class="sc">$</span>anxiety, <span class="at">n =</span> <span class="fu">nrow</span>(dat))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>model_string <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(<span class="st">"model{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st"> # Likelihood (dnorm uses a precision, not variance)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="st"> for(i in 1:n){</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st"> ern[i] ~ dnorm(beta0 + beta1*anxiety[i], tau)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="st"> }</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="st"> # Priors</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st">beta0 ~ dnorm(0, 1/3)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st">beta1 ~ dnorm(0, 1/3)</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">tau &lt;- pow(sigma,-2)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="st">sigma ~ dt(0, 1, 1)T(0,)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="st"> }"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) Load the data, specify initial values and compile the MCMC code</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a> inits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">beta0=</span><span class="fu">rnorm</span>(<span class="dv">1</span>),<span class="at">beta1=</span><span class="fu">rnorm</span>(<span class="dv">1</span>),<span class="at">sigma =</span> <span class="fu">rhalfcauchy</span>(<span class="dv">1</span>) )</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a> model <span class="ot">&lt;-</span> <span class="fu">jags.model</span>(model_string,<span class="at">data =</span> model_dat, <span class="at">inits=</span>inits, <span class="at">n.chains=</span><span class="dv">2</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a> <span class="co"># (3) Burn-in for 10000 samples</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a> <span class="fu">update</span>(model, <span class="dv">10000</span>, <span class="at">progress.bar=</span><span class="st">"none"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># (4) Generate 20000 post-burn-in samples</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a> params_name <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"beta0"</span>,<span class="st">"beta1"</span>, <span class="st">"sigma"</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a> samples <span class="ot">&lt;-</span> <span class="fu">coda.samples</span>(model,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                            <span class="at">variable.names=</span>params_name,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">n.iter=</span><span class="dv">20000</span>, <span class="at">progress.bar=</span><span class="st">"none"</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># (5) Summarize the output</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>pos_sim<span class="ot">&lt;-</span> <span class="fu">lift_dl</span>(rbind)(samples)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(pos_sim[,<span class="st">"beta0"</span>]), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(beta[<span class="dv">0</span>]), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(pos_sim[,<span class="st">"beta1"</span>]), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(beta[<span class="dv">1</span>]), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pos_sim, <span class="at">pch =</span> <span class="st">"."</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(beta[<span class="dv">0</span>]), <span class="at">ylab =</span> <span class="fu">expression</span>(beta[<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig04" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<figcaption class="figure-caption">Figure&nbsp;4: The density curve of posterior distributions of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>.</figcaption>
<p><img src="01A_basic-bayesian-model_files/figure-html/fig-fig04-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(pos_sim[,<span class="fu">c</span>(<span class="st">"beta0"</span>, <span class="st">"beta1"</span>)],<span class="dv">2</span>, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      \(i) <span class="fu">c</span>(<span class="at">estimate =</span> <span class="fu">mean</span>(i), <span class="at">std.error =</span> <span class="fu">sd</span>(i), HDInterval<span class="sc">::</span><span class="fu">hdi</span>(i)))<span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()<span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)<span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">'term'</span>)<span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Intercept"</span>, <span class="st">"anxiety"</span>))<span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()<span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(ern_mean <span class="sc">~</span> anxiety, <span class="at">data =</span> dat)<span class="sc">|&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()<span class="sc">|&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(term, estimate, std.error)<span class="sc">|&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lower =</span> estimate <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>std.error, </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>std.error)<span class="sc">|&gt;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, \(i) <span class="fu">round</span>(i,<span class="dv">2</span>))<span class="sc">|&gt;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-tbl01" class="cell tbl-parent quarto-layout-panel anchored" data-layout-ncols="2">
<div class="panel-caption table-caption">
<p>Table&nbsp;2: Estimate of the model parameters, <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>, using Bayesian and frequentist framework.</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-tbl01-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-tbl01" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption>(a) Bayesian</caption>
<thead>
<tr class="header">
<th style="text-align: center;">term</th>
<th style="text-align: center;">estimate</th>
<th style="text-align: center;">std.error</th>
<th style="text-align: center;">lower</th>
<th style="text-align: center;">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Intercept</td>
<td style="text-align: center;">-0.94</td>
<td style="text-align: center;">0.19</td>
<td style="text-align: center;">-1.32</td>
<td style="text-align: center;">-0.56</td>
</tr>
<tr class="even">
<td style="text-align: center;">anxiety</td>
<td style="text-align: center;">-0.33</td>
<td style="text-align: center;">0.19</td>
<td style="text-align: center;">-0.70</td>
<td style="text-align: center;">0.05</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-tbl01-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-tbl01" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption>(b) Frequentist</caption>
<thead>
<tr class="header">
<th style="text-align: center;">term</th>
<th style="text-align: center;">estimate</th>
<th style="text-align: center;">std.error</th>
<th style="text-align: center;">lower</th>
<th style="text-align: center;">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(Intercept)</td>
<td style="text-align: center;">-0.95</td>
<td style="text-align: center;">0.19</td>
<td style="text-align: center;">-1.32</td>
<td style="text-align: center;">-0.58</td>
</tr>
<tr class="even">
<td style="text-align: center;">anxiety</td>
<td style="text-align: center;">-0.33</td>
<td style="text-align: center;">0.19</td>
<td style="text-align: center;">-0.71</td>
<td style="text-align: center;">0.04</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>We now investigate the expected ERN, i.e.&nbsp;<span class="math inline">\(\widehat{\text{ERN}} = \hat\beta_0 + \hat\beta_1\times\text{anxiety}\)</span> and its predicted value. The <a href="#fig-fig05">Figure&nbsp;5</a> shows the regression line of expected ERN conditional on the anxiety (in black) and the credible intervals of both expected (light pink) and predicted ERN (deep pink).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1111</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">=</span> <span class="fu">sapply</span>(dat<span class="sc">$</span>anxiety, \(i) <span class="fu">mean</span>(pos_sim[,<span class="fu">c</span>(<span class="st">"beta0"</span>, <span class="st">"beta1"</span>)]<span class="sc">%*%</span><span class="fu">c</span>(<span class="dv">1</span>,i)))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>anxiety, dat<span class="sc">$</span>ern_mean, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"anxiety"</span>, <span class="at">ylab =</span> <span class="st">"ERN"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(dat<span class="sc">$</span>anxiety, y_hat, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>ci <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">sort</span>(dat<span class="sc">$</span>anxiety), \(i){</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  pos_sim[,<span class="fu">c</span>(<span class="st">"beta0"</span>, <span class="st">"beta1"</span>)]<span class="sc">%*%</span><span class="fu">c</span>(<span class="dv">1</span>,i)<span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>              HDInterval<span class="sc">::</span><span class="fu">hdi</span>()})<span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">sort</span>(dat<span class="sc">$</span>anxiety), ci[,<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"pink"</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">sort</span>(dat<span class="sc">$</span>anxiety), ci[,<span class="dv">2</span>], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"pink"</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>ci_pred<span class="ot">&lt;-</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(pos_sim, <span class="dv">1</span>, \(i){</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="fu">sort</span>(dat<span class="sc">$</span>anxiety))<span class="sc">%*%</span>i[<span class="sc">-</span><span class="dv">3</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(dat),<span class="dv">0</span>, i[<span class="dv">3</span>])</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  })<span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>ci_pred<span class="ot">&lt;-</span> <span class="fu">apply</span>(ci_pred,<span class="dv">2</span>, HDInterval<span class="sc">::</span>hdi)<span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">sort</span>(dat<span class="sc">$</span>anxiety), ci_pred[,<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"deeppink"</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">sort</span>(dat<span class="sc">$</span>anxiety), ci_pred[,<span class="dv">2</span>], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"deeppink"</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"pink"</span>, <span class="st">"deeppink"</span>), <span class="at">lty =</span> <span class="dv">1</span>, </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"expected ERN"</span>, </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"CrI of expected ERN"</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"CrI of predicted ERN"</span>), <span class="at">cex =</span> .<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig05" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<figcaption class="figure-caption">Figure&nbsp;5: Regression line.</figcaption>
<p><img src="01A_basic-bayesian-model_files/figure-html/fig-fig05-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>We may also be interested in visualizing the regression lines corresponding to some simulated parameters. <a href="#fig-fig05">Figure&nbsp;5</a> depicts regression lines pertaining to 100 parameters randomly simulated from the posterior distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">=</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(pos_sim, <span class="dv">1</span>, \(i){</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="fu">sort</span>(dat<span class="sc">$</span>anxiety))<span class="sc">%*%</span>i[<span class="sc">-</span><span class="dv">3</span>] })<span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>anxiety, dat<span class="sc">$</span>ern_mean, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"deeppink"</span>, <span class="at">xlab =</span> <span class="st">"anxiety"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"ERN"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(y_hat), <span class="dv">100</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> s){</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">sort</span>(dat<span class="sc">$</span>anxiety), y_hat[i,], <span class="at">col =</span> <span class="st">"pink"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>anxiety, dat<span class="sc">$</span>ern_mean, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"deeppink"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig06" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<figcaption class="figure-caption">Figure&nbsp;6: We randomly select 100 model parameters from their posterior distribution and calculate the expected ERN. This is 100 corresponding regression lines</figcaption>
<p><img src="01A_basic-bayesian-model_files/figure-html/fig-fig06-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-2-a-two-covariate-linear-model" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="model-2-a-two-covariate-linear-model"><span class="header-section-number">4.3</span> Model 2: a two-covariate linear model</h2>
<p>We now consider the model 2 where we consider both the anxiety and sex as two covariates of the model. <a href="#tbl-tbl02">Table&nbsp;3</a> shows the estimate, SE and credible intervals of both parameters. Those values in the brackets are the Frequentist estimates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to fit the model using rjags, we need to download and install the jags </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># software on the site before  do `install.packages("rjags")` in R. </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">39585</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>model_dat <span class="ot">=</span> <span class="fu">list</span>(<span class="at">ern =</span> dat<span class="sc">$</span>ern_mean, <span class="at">anxiety =</span> dat<span class="sc">$</span>anxiety, <span class="at">sex =</span> dat<span class="sc">$</span>sex, <span class="at">n =</span> <span class="fu">nrow</span>(dat))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>model_string <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(<span class="st">"model{</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="st"> # Likelihood (dnorm uses a precision, not variance)</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="st"> for(i in 1:n){</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="st"> ern[i] ~ dnorm(beta0 + beta1*anxiety[i] + beta2*sex[i], tau)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="st"> }</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="st"> # Priors</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="st">beta0 ~ dnorm(0, 1/3)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="st">beta1 ~ dnorm(0, 1/3)</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="st">beta2 ~ dnorm(0, 1/3)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="st">tau &lt;- pow(sigma,-2)</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="st">sigma ~ dt(0, 1, 1)T(0,)</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="st"> }"</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) Load the data, specify initial values and compile the MCMC code</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a> inits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">beta0=</span><span class="fu">rnorm</span>(<span class="dv">1</span>),<span class="at">beta1=</span><span class="fu">rnorm</span>(<span class="dv">1</span>), <span class="at">beta2=</span><span class="fu">rnorm</span>(<span class="dv">1</span>), <span class="at">sigma =</span> <span class="fu">rhalfcauchy</span>(<span class="dv">1</span>) )</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a> model <span class="ot">&lt;-</span> rjags<span class="sc">::</span><span class="fu">jags.model</span>(model_string,<span class="at">data =</span> model_dat, <span class="at">inits=</span>inits, <span class="at">n.chains=</span><span class="dv">2</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># (3) Burn-in for 10000 samples</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a> <span class="fu">update</span>(model, <span class="dv">10000</span>, <span class="at">progress.bar=</span><span class="st">"none"</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a> <span class="co"># (4) Generate 20000 post-burn-in samples</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a> params_name <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"beta0"</span>,<span class="st">"beta1"</span>, <span class="st">"beta2"</span>, <span class="st">"sigma"</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a> samples <span class="ot">&lt;-</span> rjags<span class="sc">::</span><span class="fu">coda.samples</span>(model,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>                            <span class="at">variable.names=</span>params_name,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>                            <span class="at">n.iter=</span><span class="dv">20000</span>, <span class="at">progress.bar=</span><span class="st">"none"</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co"># (5) Summarize the output</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>pos_sim<span class="ot">&lt;-</span> <span class="fu">lift_dl</span>(rbind)(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model2fit<span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(pos_sim[,<span class="fu">c</span>(<span class="st">"beta0"</span>, <span class="st">"beta1"</span>, <span class="st">"beta2"</span>)],<span class="dv">2</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>      \(i) <span class="fu">c</span>(<span class="at">estimate =</span> <span class="fu">mean</span>(i), <span class="at">std.error =</span> <span class="fu">sd</span>(i), HDInterval<span class="sc">::</span><span class="fu">hdi</span>(i)))<span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()<span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)<span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">'term'</span>)<span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">c</span>(<span class="st">"Intercept"</span>, <span class="st">"anxiety"</span>, <span class="st">"sex"</span>))<span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()<span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.double), \(i) <span class="fu">round</span>(i,<span class="dv">2</span>)<span class="sc">|&gt;</span> <span class="fu">as.character</span>()))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># frequentist</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">lm</span>(dat<span class="sc">$</span>ern_mean <span class="sc">~</span> dat<span class="sc">$</span>anxiety <span class="sc">+</span> dat<span class="sc">$</span>sex)<span class="sc">|&gt;</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()<span class="sc">|&gt;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">estimate =</span> estimate, <span class="at">std.error =</span> std.error, </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower =</span> estimate <span class="sc">-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="dv">81</span> <span class="sc">-</span><span class="dv">3</span>)<span class="sc">*</span>std.error, </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="dv">81</span> <span class="sc">-</span><span class="dv">3</span>)<span class="sc">*</span>std.error)<span class="sc">|&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(\(i) <span class="fu">round</span>(i,<span class="dv">2</span>)<span class="sc">|&gt;</span> <span class="fu">as.character</span>())</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>model2fit<span class="ot">&lt;-</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(model2fit, </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">estimate =</span> <span class="fu">paste0</span>(estimate,<span class="st">" ("</span>, m<span class="sc">$</span>estimate,<span class="st">")"</span>),</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">std.error =</span> <span class="fu">paste0</span>(std.error,<span class="st">" ("</span>, m<span class="sc">$</span>std.error,<span class="st">")"</span>),</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">lower =</span> <span class="fu">paste0</span>(lower,<span class="st">" ("</span>, m<span class="sc">$</span>lower,<span class="st">")"</span>),</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">upper =</span> <span class="fu">paste0</span>(upper,<span class="st">" ("</span>, m<span class="sc">$</span>upper,<span class="st">")"</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(model2fit, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-tbl02" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3: Estimate of the model parameters, <span class="math inline">\(\beta_0, \beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>, using Bayesian and Frequentist (in the brackets) framework.</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 22%">
<col style="width: 19%">
<col style="width: 22%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">term</th>
<th style="text-align: center;">estimate</th>
<th style="text-align: center;">std.error</th>
<th style="text-align: center;">lower</th>
<th style="text-align: center;">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Intercept</td>
<td style="text-align: center;">-1.08 (-1.13)</td>
<td style="text-align: center;">0.35 (0.37)</td>
<td style="text-align: center;">-1.75 (-1.87)</td>
<td style="text-align: center;">-0.36 (-0.4)</td>
</tr>
<tr class="even">
<td style="text-align: center;">anxiety</td>
<td style="text-align: center;">-0.34 (-0.35)</td>
<td style="text-align: center;">0.19 (0.19)</td>
<td style="text-align: center;">-0.72 (-0.73)</td>
<td style="text-align: center;">0.03 (0.04)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">sex</td>
<td style="text-align: center;">0.19 (0.25)</td>
<td style="text-align: center;">0.41 (0.43)</td>
<td style="text-align: center;">-0.61 (-0.61)</td>
<td style="text-align: center;">1.01 (1.11)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Another question we should ask after fitting two models is that which model performs the best. This is still a moot point since it depends on how researchers define the criteria to evaluate the models. Baldwin et. al. <span class="citation" data-cites="baldwin2017introduction">[<a href="#ref-baldwin2017introduction" role="doc-biblioref">1</a>]</span> suggested the three following ways of defining best:</p>
<ol type="1">
<li>Choose the model with the most statistically significant predictors;</li>
<li>Choose the model with the larges value of R<span class="math inline">\(^2\)</span> (regression) or <span class="math inline">\(\eta^2\)</span> (ANOVA);</li>
<li>Choose the most parsimonious.</li>
</ol>
<p>However, the authors also emphasized that there is no one correct way to define the best. Further, if the prediction is the primary aim, cross-validation could be used to examine out-of-sample prediction. Two metrics that are commonly used are Widely Applicable Information Criterion (WAIC) and Leave- one-out Cross-validation (LOOCV). Both approaches aim to assess the accuracy of making predictions in new samples. Since they approximate the deviance for new samples and, thus, a smaller value indicates the better fit. WAIC and LOOCV is provided by several R packages, including the <code>brms</code> package.</p>
<p>We now obtain LOOCV of the two models using the <code>brms</code>. The WAIC can be obtained in the same manner.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(ern_mean <span class="sc">~</span> anxiety, <span class="at">data =</span> dat,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">set_prior</span>(<span class="st">"normal(0,3)"</span>, <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">set_prior</span>(<span class="st">"cauchy(0,2.5)"</span>, <span class="at">class =</span> <span class="st">"sigma"</span>)),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="at">seed =</span> <span class="dv">394589</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">update</span>(mod1, <span class="at">formula. =</span> <span class="sc">~</span> . <span class="sc">+</span> sex, <span class="at">newdata =</span> dat, <span class="at">seed =</span> <span class="dv">39585</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Comparing Models using The WAIC() and LOO() functions from brms</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>LOO shown in <a href="#tbl-tbl03">Table&nbsp;4</a> indicate that model 1 is better fit than model 2; however, the difference is not statistically significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>loo_mod <span class="ot">=</span> <span class="fu">loo</span>(mod1, mod2)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>loo_mod<span class="sc">$</span>diffs<span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"model"</span>)<span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, looic, se_looic)<span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, round, <span class="at">digits =</span> <span class="dv">3</span>)<span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-tbl03" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;4: LOO of model 1 and 2.</caption>
<thead>
<tr class="header">
<th style="text-align: center;">model</th>
<th style="text-align: center;">looic</th>
<th style="text-align: center;">se_looic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">mod1</td>
<td style="text-align: center;">321.136</td>
<td style="text-align: center;">13.654</td>
</tr>
<tr class="even">
<td style="text-align: center;">mod2</td>
<td style="text-align: center;">323.257</td>
<td style="text-align: center;">13.951</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="bayes-factors" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Bayes factors</h1>
<p>Another task that interests researchers when using the Bayesian framework is hypothesis testing. Unlike the frequentist paradigm, Bayes method uses the Bayes factor, which is expressed as follows, to evaluate the hypotheses.</p>
<p><span class="math display">\[
\frac{\mathbb{P}(H_A|\text{data})}{\mathbb{P}(H_0|\text{data})} =
\frac{\mathbb{P}(\text{data}|H_A)}{\mathbb{P}(\text{data}|H_0)}\times \frac{\mathbb{P}(H_A)}{\mathbb{P}(H_0)}.
\]</span></p>
<p>The term on the left side is the ratio of posterior alternative hypothesis and posterior null hypothesis, the second term on the right side is the ratio of prior alternative hypothesis and the prior null hypothesis, and first term on the right side is the Bayes factor. The Bayes factor quantifies how our belief in <span class="math inline">\(H_A\)</span> relative to that in <span class="math inline">\(H_0\)</span> as the result of data. For example, we evaluate the efficacy of two treatments, and <span class="math inline">\(H_A\)</span> is the statement that the efficacy of two treatments differs while <span class="math inline">\(H_0\)</span> is that the efficacy of two treatments are the same. A Bayes factor higher than <span class="math inline">\(1\)</span> implies the data are more likely given <span class="math inline">\(H_A\)</span> than they are given <span class="math inline">\(H_0\)</span>. I.e., <span class="math inline">\(H_A\)</span> is more evident than <span class="math inline">\(H_0\)</span>. A full worked example of Bayes factor is beyond the scope of the paper, so the authors did not give details.</p>
<p>In the paper, the authors also discussed the generalized linear and mix models, but we only consider linear models.</p>
<!-- ------------------------- -->
</section>
<section id="references" class="level1" data-number="6">

<!-- ------------------------ -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">6 References</h2><div id="refs" class="references csl-bib-body" role="list">
<div id="ref-baldwin2017introduction" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Baldwin SA, Larson MJ. An introduction to using bayesian linear regression with clinical data. Behaviour research and therapy. 2017;98:58–75. </div>
</div>
<div id="ref-klauenberg2015tutorial" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Klauenberg K, Wübbeler G, Mickan B, Harris P, Elster C. A tutorial on bayesian normal linear regression. Metrologia. 2015;52(6):878. </div>
</div>
<div id="ref-rencher2008linear" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Rencher AC, Schaalje GB. Linear models in statistics. John Wiley &amp; Sons; 2008. </div>
</div>
<div id="ref-neville2016double" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Neville DN, Hayes KR, Ivan Y, McDowell ER, Pitetti RD. Double-blind randomized controlled trial of intranasal dexmedetomidine versus intranasal midazolam as anxiolysis prior to pediatric laceration repair in the emergency department. Academic Emergency Medicine. 2016;23(8):910–7. </div>
</div>
<div id="ref-cai2021estimating" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Cai S, Zhou J, Pan J. Estimating the sample mean and standard deviation from order statistics and sample size in meta-analysis. Statistical methods in medical research. 2021;30(12):2701–19. </div>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>